(function(){$.fn.autoComplete=function(p){var b={requestDelay:2000,closeDelay:4000},d=$.extend(b,p),i=$(this),s="",w=i.outerWidth(),e=i.offset(),u=e.top+i.outerHeight(),j=e.left,m=b.requestDelay,n=b.closeDelay,q={},g=i.parent(),o,r,v=-1,h,x,l=$("<ul>").attr({id:"autoSuggest"}).bind("click",function(z){z=z||window.event;var y=z.target||z.srcElement;if(y.nodeName.toLowerCase()!=="li"){return}g.submit();$(this).hide();v=-1}).bind("mouseover",function(A){clearTimeout(x);A=A||window.event;var z=A.target||A.srcElement,y=$(z);if(z.nodeName.toLowerCase()==="li"&&!y.hasClass("hover")){r.removeClass("hover");y.addClass("hover");v=r.index(y);f(l.find("li:eq("+(v)+")").text())}}).bind("mouseout",function(){x=setTimeout(function(){l.hide();v=-1},n)}).hide().appendTo($("body"));i.keyup(function(y){clearTimeout(o);if(!/27$|38$|40$/.test(y.keyCode)){o=setTimeout(a,m)}}).blur(function(){setTimeout(function(){l.hide();v=-1},100)}).keydown(function(y){y=y||window.event;switch(y.keyCode){case 40:c(true);break;case 38:c(false);break;case 13:g.submit();break}});function f(y){if(y!=s){i.val(y);s=y;return true}return false}function a(){var B=i.val(),A=f(B);if(B===""){l.hide();v=-1;return}var z=encodeURIComponent(B);if(A){var y="http://data.house.sina.com.cn/api/search_suggest.php?city=bj&q="+z+"&callback=?";k(B,y)}}function k(z,y){if(q[z]){t(q[z])}else{$.ajaxSetup({scriptCharset:"utf-8",contentType:"text/javascript; charset=utf-8"});$.getJSON(y,function(A){q[z]=A;t(A)})}}function t(A){clearTimeout(x);if(typeof(A)==="string"){B=["<li>",A,"</li>"]}else{var y=A.length,B=[];h=y;for(var z=0;z<y;z++){var C=["<li>",A[z].name,"</li>"];B=B.concat(C)}}l.css({top:u+"px",left:j+"px",width:w+"px"}).html(B.join("")).show();r=l.find("li");x=setTimeout(function(){l.hide();v=-1},n)}function c(y){clearTimeout(x);l.find("li").removeClass("hover");if(y){v=v==h-1?0:v+1;l.find("li:eq("+(v)+")").addClass("hover");f(l.find("li:eq("+(v)+")").text())}else{v=v==0?h-1:v-1;l.find("li:eq("+(v)+")").addClass("hover");f(l.find("li:eq("+(v)+")").text())}}}})(jQuery);